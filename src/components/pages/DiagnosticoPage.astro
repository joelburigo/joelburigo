---
import { CheckCircle2, AlertCircle, TrendingUp } from 'lucide-react';

const diagnosticoQuestions = [
  {
    p: 'Posicionamento',
    icon: 'target',
    questions: [
      { id: 'pos1', text: 'Você consegue explicar em 1 frase o que faz sua solução ser única?' },
      { id: 'pos2', text: 'Seu mercado reconhece você como autoridade/referência?' },
      { id: 'pos3', text: 'Você tem clareza de qual problema específico resolve?' },
      { id: 'pos4', text: 'Seus concorrentes copiam o que você faz?' },
    ],
  },
  {
    p: 'Público',
    icon: 'users',
    questions: [
      { id: 'pub1', text: 'Você tem um ICP (Ideal Customer Profile) documentado?' },
      { id: 'pub2', text: 'Sabe exatamente onde seus clientes ideais estão?' },
      { id: 'pub3', text: 'Consegue prever o LTV (Lifetime Value) dos seus clientes?' },
      { id: 'pub4', text: 'Tem uma lista qualificada de prospects para abordar?' },
    ],
  },
  {
    p: 'Produto',
    icon: 'package',
    questions: [
      { id: 'prod1', text: 'Seu produto/serviço tem diferenciais claros e tangíveis?' },
      { id: 'prod2', text: 'A entrega é consistente e previsível?' },
      { id: 'prod3', text: 'Você tem cases/resultados documentados?' },
      { id: 'prod4', text: 'Seu produto é escalável (pode crescer sem você)?' },
    ],
  },
  {
    p: 'Programas',
    icon: 'layers',
    questions: [
      { id: 'prog1', text: 'Tem diferentes pacotes/níveis de serviço?' },
      { id: 'prog2', text: 'Oferece upsell/cross-sell estruturado?' },
      { id: 'prog3', text: 'A precificação está baseada em valor (não custo/hora)?' },
      { id: 'prog4', text: 'Tem um roadmap de evolução de produtos?' },
    ],
  },
  {
    p: 'Processos',
    icon: 'workflow',
    questions: [
      { id: 'proc1', text: 'Seu funil de vendas está mapeado e documentado?' },
      { id: 'proc2', text: 'Usa CRM para rastrear todas as oportunidades?' },
      { id: 'proc3', text: 'Tem playbooks/scripts para cada etapa da venda?' },
      { id: 'proc4', text: 'Acompanha métricas (taxa conversão, ticket médio, ciclo)?' },
    ],
  },
  {
    p: 'Pessoas',
    icon: 'users-2',
    questions: [
      { id: 'pes1', text: 'Tem um time de vendas treinado (ou é só você)?' },
      { id: 'pes2', text: 'Existe um programa de onboarding para novos vendedores?' },
      { id: 'pes3', text: 'A equipe tem metas claras e é cobrada por elas?' },
      { id: 'pes4', text: 'Vendedores são remunerados com variável por performance?' },
    ],
  },
];
---

<div class="min-h-screen bg-gradient-to-br from-dark via-gray-900 to-dark pb-20 pt-32">
  <div class="container mx-auto max-w-4xl px-4">
    <!-- Hero -->
    <div class="mb-12 text-center">
      <div class="mb-4 inline-flex items-center gap-2 rounded-full bg-lime/10 px-4 py-2">
        <TrendingUp className="h-4 w-4 text-lime" />
        <span class="font-sans text-sm font-medium text-lime">100% Gratuito</span>
      </div>
      <h1 class="mb-4 font-display text-display-lg text-white">
        Diagnóstico <span class="text-lime">6Ps</span>
      </h1>
      <p class="mx-auto max-w-2xl font-sans text-body-lg text-gray-300">
        Responda 24 perguntas objetivas e descubra exatamente qual P está travando suas vendas.
        <strong class="text-white">Leva 5 minutos.</strong>
      </p>
    </div>

    <!-- Info Cards -->
    <div class="mb-12 grid gap-6 md:grid-cols-3">
      <div class="rounded-xl border border-white/10 bg-white/5 p-6 text-center backdrop-blur-sm">
        <div class="mb-2 font-display text-h2 text-lime">24</div>
        <div class="font-sans text-sm text-gray-400">Perguntas Sim/Não</div>
      </div>
      <div class="rounded-xl border border-white/10 bg-white/5 p-6 text-center backdrop-blur-sm">
        <div class="mb-2 font-display text-h2 text-lime">5min</div>
        <div class="font-sans text-sm text-gray-400">Tempo Médio</div>
      </div>
      <div class="rounded-xl border border-white/10 bg-white/5 p-6 text-center backdrop-blur-sm">
        <div class="mb-2 font-display text-h2 text-lime">6Ps</div>
        <div class="font-sans text-sm text-gray-400">Áreas Avaliadas</div>
      </div>
    </div>

    <!-- Formulário -->
    <div class="rounded-2xl border border-white/10 bg-white/5 p-8 backdrop-blur-sm">
      <form id="diagnostico-form" class="space-y-10">
        <!-- Dados do Lead -->
        <div class="space-y-4 rounded-xl border border-lime/20 bg-lime/5 p-6">
          <h3 class="mb-4 font-display text-h4 text-white">Seus Dados</h3>
          <div class="grid gap-4 md:grid-cols-2">
            <div>
              <label for="name" class="mb-2 block font-sans text-sm font-medium text-gray-300">
                Nome Completo *
              </label>
              <input
                type="text"
                id="name"
                required
                class="w-full rounded-lg border border-white/20 bg-white/10 px-4 py-3 font-sans text-white placeholder-gray-500 outline-none transition-all focus:border-lime focus:ring-2 focus:ring-lime/20"
                placeholder="Joel Burigo"
              />
            </div>
            <div>
              <label for="email" class="mb-2 block font-sans text-sm font-medium text-gray-300">
                Email Corporativo *
              </label>
              <input
                type="email"
                id="email"
                required
                class="w-full rounded-lg border border-white/20 bg-white/10 px-4 py-3 font-sans text-white placeholder-gray-500 outline-none transition-all focus:border-lime focus:ring-2 focus:ring-lime/20"
                placeholder="seu@empresa.com.br"
              />
            </div>
            <div>
              <label for="company" class="mb-2 block font-sans text-sm font-medium text-gray-300">
                Empresa
              </label>
              <input
                type="text"
                id="company"
                class="w-full rounded-lg border border-white/20 bg-white/10 px-4 py-3 font-sans text-white placeholder-gray-500 outline-none transition-all focus:border-lime focus:ring-2 focus:ring-lime/20"
                placeholder="Nome da empresa"
              />
            </div>
            <div>
              <label for="revenue" class="mb-2 block font-sans text-sm font-medium text-gray-300">
                Faturamento Mensal Aprox.
              </label>
              <select
                id="revenue"
                class="w-full rounded-lg border border-white/20 bg-white/10 px-4 py-3 font-sans text-white outline-none transition-all focus:border-lime focus:ring-2 focus:ring-lime/20"
              >
                <option value="">Selecione...</option>
                <option value="0-10k">R$ 0 - 10k</option>
                <option value="10k-50k">R$ 10k - 50k</option>
                <option value="50k-100k">R$ 50k - 100k</option>
                <option value="100k-300k">R$ 100k - 300k</option>
                <option value="300k+">R$ 300k+</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Perguntas dos 6Ps -->
        {
          diagnosticoQuestions.map((section, sectionIdx) => (
            <div class="space-y-4">
              <div class="flex items-center gap-3">
                <div class="flex h-10 w-10 items-center justify-center rounded-lg bg-lime text-dark">
                  <span class="font-display text-h5">{sectionIdx + 1}</span>
                </div>
                <h3 class="font-display text-h4 text-white">{section.p}</h3>
              </div>
              <div class="space-y-3">
                {section.questions.map((q) => (
                  <label class="group flex cursor-pointer items-start gap-4 rounded-lg border border-white/10 bg-white/5 p-4 transition-all hover:border-lime/30 hover:bg-white/10">
                    <div class="flex gap-4 pt-1">
                      <label class="flex cursor-pointer items-center gap-2">
                        <input
                          type="radio"
                          name={q.id}
                          value="sim"
                          class="h-5 w-5 cursor-pointer border-2 border-white/30 bg-transparent text-lime focus:ring-2 focus:ring-lime/20"
                        />
                        <span class="font-sans text-sm text-gray-400">Sim</span>
                      </label>
                      <label class="flex cursor-pointer items-center gap-2">
                        <input
                          type="radio"
                          name={q.id}
                          value="nao"
                          class="h-5 w-5 cursor-pointer border-2 border-white/30 bg-transparent text-red-500 focus:ring-2 focus:ring-red-500/20"
                        />
                        <span class="font-sans text-sm text-gray-400">Não</span>
                      </label>
                    </div>
                    <span class="flex-1 font-sans text-body text-gray-300">{q.text}</span>
                  </label>
                ))}
              </div>
            </div>
          ))
        }

        <!-- Resultado (hidden inicialmente) -->
        <div id="resultado" class="hidden space-y-6">
          <div class="rounded-xl border border-lime/30 bg-lime/10 p-8 text-center">
            <CheckCircle2 className="mx-auto mb-4 h-16 w-16 text-lime" />
            <h3 class="mb-2 font-display text-h3 text-white">Diagnóstico Completo!</h3>
            <p class="mb-6 font-sans text-body-lg text-gray-300">
              Sua pontuação por P está calculada abaixo:
            </p>

            <!-- Scores por P -->
            <div id="scores" class="grid gap-4 md:grid-cols-3">
              {/* Preenchido via JavaScript */}
            </div>

            <div class="mt-8 rounded-lg border border-white/10 bg-white/5 p-6">
              <AlertCircle className="mx-auto mb-3 h-8 w-8 text-lime" />
              <p class="mb-4 font-sans text-body text-gray-300">
                <strong class="text-white">Próximo Passo:</strong> Enviei para seu email um relatório
                detalhado com recomendações específicas para cada P.
              </p>
              <p class="font-sans text-sm text-gray-400">
                Quer acelerar? Agende uma{' '}
                <a href="/advisory" class="font-semibold text-lime hover:underline">
                  Sessão Estratégica
                </a>{' '}
                comigo.
              </p>
            </div>
          </div>
        </div>

        <!-- Submit Button -->
        <div class="text-center">
          <button
            type="submit"
            class="inline-flex items-center gap-2 rounded-lg bg-lime px-8 py-4 font-display text-h5 text-dark transition-all hover:bg-lime/90 hover:shadow-xl hover:shadow-lime/20"
          >
            <TrendingUp className="h-5 w-5" />
            Ver Meu Diagnóstico
          </button>
          <p class="mt-4 font-sans text-xs text-gray-500">
            Seus dados estão seguros. Não compartilho com terceiros.
          </p>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  document.getElementById('diagnostico-form')?.addEventListener('submit', function (e) {
    e.preventDefault();

    const formData = new FormData(e.target as HTMLFormElement);
    const name = formData.get('name') as string;
    const email = formData.get('email') as string;

    // Validação básica
    if (!name || !email) {
      alert('Preencha nome e email para continuar.');
      return;
    }

    // Calcular scores por P
    const ps = ['pos', 'pub', 'prod', 'prog', 'proc', 'pes'];
    const scores: { [key: string]: { name: string; score: number; percentage: number } } = {};

    ps.forEach((p, idx) => {
      let yesCount = 0;
      for (let i = 1; i <= 4; i++) {
        const answer = formData.get(`${p}${i}`);
        if (answer === 'sim') yesCount++;
      }
      const percentage = (yesCount / 4) * 100;
      const pNames = [
        'Posicionamento',
        'Público',
        'Produto',
        'Programas',
        'Processos',
        'Pessoas',
      ];
      scores[p] = { name: pNames[idx], score: yesCount, percentage };
    });

    // Exibir resultado
    const scoresContainer = document.getElementById('scores');
    if (scoresContainer) {
      scoresContainer.innerHTML = '';
      Object.entries(scores).forEach(([key, data]) => {
        const scoreCard = document.createElement('div');
        scoreCard.className = 'rounded-lg border border-white/10 bg-white/5 p-4';
        scoreCard.innerHTML = `
          <div class="mb-2 font-display text-h4 text-lime">${data.score}/4</div>
          <div class="mb-1 font-sans text-sm font-medium text-white">${data.name}</div>
          <div class="font-sans text-xs text-gray-400">${data.percentage.toFixed(0)}%</div>
        `;
        scoresContainer.appendChild(scoreCard);
      });
    }

    // Scroll e mostrar resultado
    const resultadoDiv = document.getElementById('resultado');
    if (resultadoDiv) {
      resultadoDiv.classList.remove('hidden');
      resultadoDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }

    // Aqui você enviaria os dados para seu backend/CRM
    console.log('Diagnóstico submetido:', {
      name,
      email,
      company: formData.get('company'),
      revenue: formData.get('revenue'),
      scores,
    });

    // Simular envio (substitua por API real)
    // fetch('/api/diagnostico', { method: 'POST', body: JSON.stringify(...) })
  });
</script>

<style>
  input[type='radio'] {
    accent-color: theme('colors.lime');
  }

  input[type='radio']:checked {
    background-color: theme('colors.lime');
    border-color: theme('colors.lime');
  }
</style>
