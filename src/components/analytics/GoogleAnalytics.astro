---
// Google Analytics 4 - Direct Implementation
// Hardcoded para simplificar (n√£o depende do GTM)
const GA4_ID = 'G-Z2XMZ448VV'
---

<!-- Google Analytics 4 - Lazy Loaded -->
<script is:inline define:vars={{ GA4_ID }}>
  (function() {
    let gaLoaded = false;
    
    function initGA() {
      if (gaLoaded) return;
      gaLoaded = true;
      
      // Load gtag script
      const script = document.createElement('script');
      script.async = true;
      script.src = `https://www.googletagmanager.com/gtag/js?id=${GA4_ID}`;
      document.head.appendChild(script);
      
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', GA4_ID, {
        page_path: window.location.pathname,
      });
    }
    
    // Load after interaction or 3 seconds
    const events = ['mousedown', 'touchstart', 'keydown', 'scroll'];
    events.forEach(event => {
      window.addEventListener(event, initGA, { once: true, passive: true });
    });
    setTimeout(initGA, 3000);
  })();
</script>

<!-- Track GA4 on SPA navigation -->
<script>
  function trackGA4PageView() {
    if (typeof window !== 'undefined' && typeof (window as any).gtag === 'function') {
      (window as any).gtag('event', 'page_view', {
        page_location: window.location.href,
        page_path: window.location.pathname,
        page_title: document.title,
      });
    }
  }
  
  document.addEventListener('astro:after-swap', trackGA4PageView);
</script>
