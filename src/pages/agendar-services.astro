---
import Layout from '../layouts/Layout.astro'
import Header from '../components/layout/Header.astro'
import Footer from '../components/layout/Footer.astro'
import Container from '../components/ui/Container.astro'
import Icons from '../components/ui/Icons.astro'

const seo = {
  title: 'Agendar Conversa - Implementation Services | Joel Burigo',
  description: 'Agende uma conversa estratégica para entender se Implementation Services é a solução certa para o seu negócio.',
  keywords: 'agendar consultoria, consultoria vendas, Joel Burigo',
}

const beneficios = [
  { icon: 'calendar', text: 'Conversa de 30-45 minutos' },
  { icon: 'clipboard-list', text: 'Análise do seu momento atual' },
  { icon: 'target', text: 'Recomendação personalizada' },
  { icon: 'check-circle', text: 'Sem compromisso' },
]
---

<Layout title={seo.title} description={seo.description} keywords={seo.keywords} noIndex={true}>
  <Header />
  
  <main class="flex-grow bg-dark pt-24 pb-16">
    <Container>
      <div class="mx-auto max-w-6xl">
        
        <!-- Header -->
        <div class="mb-12 text-center">
          <span class="mb-4 inline-block rounded-full border border-lime/30 bg-lime/10 px-4 py-1.5 text-sm font-display font-bold text-lime backdrop-blur-sm">
            IMPLEMENTATION SERVICES
          </span>
          <h1 class="mb-6 font-display text-display-sm text-white md:text-display-md">
            Agende uma <span class="text-lime">Conversa Estratégica</span>
          </h1>
          <p class="mx-auto max-w-2xl font-sans text-body-lg text-gray-200">
            Vamos entender seu momento atual, seus desafios e verificar se Implementation Services é a solução certa para você.
          </p>
        </div>

        <!-- Benefícios -->
        <div class="mb-12 grid grid-cols-2 gap-4 md:grid-cols-4">
          {beneficios.map((item) => (
            <div class="flex flex-col items-center gap-2 rounded-xl border border-white/10 bg-white/5 p-4 text-center backdrop-blur-sm">
              <div class="rounded-full bg-lime/20 p-2">
                <Icons name={item.icon} class="h-5 w-5 text-lime" />
              </div>
              <span class="text-sm text-gray-200">{item.text}</span>
            </div>
          ))}
        </div>

        <!-- Calendário Embed -->
        <div class="rounded-2xl border-2 border-lime/20 bg-white/5 p-6 backdrop-blur-sm md:p-8">
          <div class="mb-6 text-center">
            <h2 class="mb-2 font-display text-h2 text-white">
              Escolha o Melhor Horário
            </h2>
            <p class="font-sans text-body text-gray-300">
              Selecione data e horário que funcionam melhor para você
            </p>
          </div>

          <!-- Calendário do CRM (Lazy Load) -->
          <div 
            class="calendar-wrapper min-h-[700px] rounded-xl bg-white overflow-hidden"
            data-calendar-id="0NBqf6z2SSM2gIPjjV4w"
          >
            <!-- Placeholder enquanto carrega -->
            <div class="calendar-placeholder">
              <div class="animate-pulse flex flex-col items-center justify-center h-[700px] gap-4">
                <Icons name="calendar" class="h-16 w-16 text-lime/30" />
                <p class="font-sans text-body text-gray-400">Carregando calendário...</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Info Adicional -->
        <div class="mt-8 rounded-xl border border-white/10 bg-white/5 p-6 backdrop-blur-sm">
          <div class="flex items-start gap-4">
            <div class="rounded-full bg-lime/20 p-2">
              <Icons name="info" class="h-5 w-5 text-lime" />
            </div>
            <div>
              <h3 class="mb-2 font-display text-h4 text-white">
                O que vai acontecer na conversa?
              </h3>
              <ul class="space-y-2 font-sans text-body text-gray-200">
                <li class="flex items-start gap-2">
                  <Icons name="check" class="mt-1 h-4 w-4 shrink-0 text-lime" />
                  <span>Vamos entender seu negócio, faturamento atual e principais desafios</span>
                </li>
                <li class="flex items-start gap-2">
                  <Icons name="check" class="mt-1 h-4 w-4 shrink-0 text-lime" />
                  <span>Avaliaremos qual pacote (Fundação, Aceleração ou ScaleUp) faz mais sentido</span>
                </li>
                <li class="flex items-start gap-2">
                  <Icons name="check" class="mt-1 h-4 w-4 shrink-0 text-lime" />
                  <span>Você vai sair com um plano claro do que precisa estruturar</span>
                </li>
                <li class="flex items-start gap-2">
                  <Icons name="check" class="mt-1 h-4 w-4 shrink-0 text-lime" />
                  <span>Se fizer sentido para ambos, definimos próximos passos</span>
                </li>
              </ul>
            </div>
          </div>
        </div>

      </div>
    </Container>
  </main>

  <Footer />
</Layout>

<!-- Preconnect para otimizar carregamento -->
<link rel="preconnect" href="https://api.gsh.digital" slot="head" />
<link rel="dns-prefetch" href="https://api.gsh.digital" slot="head" />

<style>
  .calendar-wrapper {
    position: relative;
  }
  
  .calendar-placeholder {
    width: 100%;
  }
  
  .calendar-loaded .calendar-placeholder {
    display: none;
  }
  
  iframe {
    max-width: 100%;
  }
</style>

<script>
  // Lazy load do calendário com Intersection Observer
  function initCalendar() {
    const calendarWrapper = document.querySelector('.calendar-wrapper');
    if (!calendarWrapper) return;

    const calendarId = calendarWrapper.getAttribute('data-calendar-id');
    if (!calendarId) return;

    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          loadCalendar(calendarWrapper as HTMLElement, calendarId);
          observer.unobserve(entry.target);
        }
      });
    }, {
      rootMargin: '100px' // Começa a carregar 100px antes de aparecer
    });

    observer.observe(calendarWrapper);
  }

  function loadCalendar(container: HTMLElement, calendarId: string) {
    // Criar o iframe
    const iframe = document.createElement('iframe');
    iframe.src = `https://api.gsh.digital/widget/booking/${calendarId}`;
    iframe.style.cssText = 'width: 100%; border: none; overflow: hidden; min-height: 700px;';
    iframe.id = `${calendarId}_${Date.now()}`;
    iframe.title = 'Agendar Conversa Estratégica';

    // Adicionar o iframe
    container.appendChild(iframe);
    container.classList.add('calendar-loaded');

    // Carregar o script de embed
    if (!document.querySelector('script[src*="form_embed.js"]')) {
      const script = document.createElement('script');
      script.src = 'https://api.gsh.digital/js/form_embed.js';
      script.type = 'text/javascript';
      script.async = true;
      document.body.appendChild(script);
    }
  }

  // Inicializar quando o DOM estiver pronto
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initCalendar);
  } else {
    initCalendar();
  }
</script>
